(function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof module&&module.exports?module.exports=t():e.Tobi=t()})(this,function(){"use strict";var e=function(e){var t=function(e){var t={selector:".lightbox",captions:!0,captionsSelector:"img",captionAttribute:"alt",nav:"auto",navText:["&lsaquo;","&rsaquo;"],close:!0,closeText:"&times;",counter:!0,keyboard:!0,zoom:!0,zoomText:"&plus;",docClose:!1,swipeClose:!0,scroll:!1,draggable:!0,threshold:20};return e&&Object.keys(e).forEach(function(n){t[n]=e[n]}),t},n={},i=null,a=[],o=0,r=null,s=null,d=[],c=0,l={},u=!1,m=null,b=document.createElement("div");b.setAttribute("role","dialog"),b.setAttribute("aria-hidden","true"),b.classList.add("tobi-overlay"),document.getElementsByTagName("body")[0].appendChild(b);var f=document.createElement("div");f.classList.add("tobi-slider"),b.appendChild(f);var g=document.createElement("button");g.setAttribute("type","button"),g.setAttribute("aria-label","Previous"),b.appendChild(g);var p=document.createElement("button");p.setAttribute("type","button"),p.setAttribute("aria-label","Next"),b.appendChild(p);var v=document.createElement("button");v.setAttribute("type","button"),v.setAttribute("aria-label","Close"),b.appendChild(v);var h=document.createElement("div");h.classList.add("tobi-counter"),b.appendChild(h);var E=function(){var e=document.documentElement.style;return"string"==typeof e.transform?"transform":"WebkitTransform"},L=function(e,t){if("undefined"!=typeof a[e]&&"undefined"!=typeof d[e]){if(!d[e].getElementsByTagName("img")[0].hasAttribute("data-src"))return void(t&&t());var n=d[e].getElementsByTagName("figure")[0],i=n.getElementsByTagName("img")[0],o=n.getElementsByTagName("figcaption")[0];i.onload=function(){var e=n.querySelector(".tobi-loader");n.removeChild(e),i.style.opacity="1",o&&(o.style.opacity="1")},i.setAttribute("src",i.getAttribute("data-src")),i.removeAttribute("data-src"),t&&t()}},y=function(){var e=100*-c+"%";f.style[i]="translate3d("+e+", 0, 0)"},A=function(){h.innerHTML=c+1+"/"+s},T=function(e){n.nav?(g.disabled=!1,p.disabled=!1,c===s-1?p.disabled=!0:0===c&&(g.disabled=!0),e||p.disabled?e||!p.disabled||g.disabled?p.disabled||"right"!==e?p.disabled&&"right"===e&&!g.disabled?g.focus():g.disabled||"left"!==e?g.disabled&&"left"===e&&!p.disabled&&p.focus():g.focus():p.focus():g.focus():p.focus()):n.close&&v.focus()},k=function(e){L(e)},C=function(){c<s-1&&(c++,y(),A(),T("right"),k(c+1))},X=function(){c>0&&(c--,y(),A(),T("left"),k(c-1))},w=function(e){var t=null,i=null,a=null,r=null,c=null;t=document.createElement("div"),t.classList.add("tobi-slide"),i=document.createElement("div"),i.classList.add("tobi-figure-wrapper"),a=document.createElement("figure"),a.classList.add("tobi-figure"),a.innerHTML='<div class="tobi-loader"></div>',r=document.createElement("img"),r.style.opacity="0",e.getElementsByTagName("img")[0]&&e.getElementsByTagName("img")[0].alt?r.alt=e.getElementsByTagName("img")[0].alt:r.alt="",r.setAttribute("src",""),r.setAttribute("data-src",e.href),a.appendChild(r),n.captions&&(c=document.createElement("figcaption"),c.style.opacity="0","self"===n.captionsSelector&&e.getAttribute(n.captionAttribute)?c.innerHTML=e.getAttribute(n.captionAttribute):"img"===n.captionsSelector&&e.getElementsByTagName("img")[0]&&e.getElementsByTagName("img")[0].getAttribute(n.captionAttribute)&&(c.innerHTML=e.getElementsByTagName("img")[0].getAttribute(n.captionAttribute)),c.innerHTML&&(c.id="tobi-figcaption-"+o,a.appendChild(c),r.setAttribute("aria-labelledby",c.id))),i.appendChild(a),t.appendChild(i),f.appendChild(t),d.push(t),++o,!n.nav||1===s||"auto"===n.nav&&"ontouchstart"in window?(g.setAttribute("aria-hidden","true"),p.setAttribute("aria-hidden","true")):(g.setAttribute("aria-hidden","false"),p.setAttribute("aria-hidden","false"),g.innerHTML=n.navText[0],p.innerHTML=n.navText[1]),n.counter&&1!==s?h.setAttribute("aria-hidden","false"):h.setAttribute("aria-hidden","true"),n.close?v.innerHTML=n.closeText:v.setAttribute("aria-hidden","true"),n.draggable&&(f.style.cursor="-webkit-grab")},x=function(e){"false"!==b.getAttribute("aria-hidden")&&(n.scroll||(document.documentElement.classList.add("tobi--is-open"),document.body.classList.add("tobi--is-open")),m=document.activeElement,c=e,B(),I(),L(c,function(){k(c+1),k(c-1)}),y(),A(),b.setAttribute("aria-hidden","false"),T())},N=function(){"true"!==b.getAttribute("aria-hidden")&&(n.scroll||(document.documentElement.classList.remove("tobi--is-open"),document.body.classList.remove("tobi--is-open")),U(),b.setAttribute("aria-hidden","true"),m.focus())},B=function(){l={startX:0,endX:0,startY:0,endY:0}},M=function(){var e=l.endX-l.startX,t=l.endY-l.startY,i=Math.abs(e),a=Math.abs(t);e>0&&i>n.threshold?X():e<0&&i>n.threshold?C():t<0&&a>n.threshold&&n.swipeClose&&N()},H=function(e){e.target===g?X():e.target===p?C():(e.target===v||e.target.classList.contains("tobi-figure-wrapper")&&!e.target.classList.contains("tobi-figure"))&&N(),e.stopPropagation()},P=function(e){switch(e.keyCode){case 37:X();break;case 39:C();break;case 27:N()}},Y=function(e){e.stopPropagation(),u=!0,l.startX=e.touches[0].pageX,l.startY=e.touches[0].pageY},z=function(e){e.preventDefault(),e.stopPropagation(),u&&(l.endX=e.touches[0].pageX,l.endY=e.touches[0].pageY)},S=function(e){e.stopPropagation(),u=!1,l.endX&&M(),B()},q=function(e){e.preventDefault(),e.stopPropagation(),u=!0,l.startX=e.pageX},D=function(e){e.stopPropagation(),u=!1,f.style.cursor="-webkit-grab",l.endX&&M(),B()},O=function(e){e.preventDefault(),u&&(l.endX=e.pageX,f.style.cursor="-webkit-grabbing")},j=function(e){u&&(u=!1,f.style.cursor="-webkit-grab",l.endX=e.pageX,M(),B())},_=function(e){"false"!==b.getAttribute("aria-hidden")||b.contains(e.target)||(e.stopPropagation(),T())},I=function(){n.keyboard&&document.addEventListener("keydown",P),n.docClose&&b.addEventListener("click",H),g.addEventListener("click",H),p.addEventListener("click",H),v.addEventListener("click",H),n.draggable&&(b.addEventListener("touchstart",Y),b.addEventListener("touchmove",z),b.addEventListener("touchend",S),b.addEventListener("mousedown",q),b.addEventListener("mouseup",D),b.addEventListener("mouseleave",j),b.addEventListener("mousemove",O)),document.addEventListener("focus",_,!0)},U=function(){n.keyboard&&document.removeEventListener("keydown",P),n.docClose&&b.removeEventListener("click",H),g.removeEventListener("click",H),p.removeEventListener("click",H),v.removeEventListener("click",H),n.draggable&&(b.removeEventListener("touchstart",Y),b.removeEventListener("touchmove",z),b.removeEventListener("touchend",S),b.removeEventListener("mousedown",q),b.removeEventListener("mouseup",D),b.removeEventListener("mouseleave",j),b.removeEventListener("mousemove",O)),document.removeEventListener("focus",_)},W=function(e){if(a.indexOf(e)===-1){if(a.push(e),e.classList.add("tobi"),n.zoom&&e.getElementsByTagName("img")[0]){var t=document.createElement("div");t.classList.add("tobi__zoom-icon"),t.innerHTML=n.zoomText,e.classList.add("tobi--zoom"),e.appendChild(t)}e.addEventListener("click",function(e){e.preventDefault(),x(a.indexOf(this))}),w(e)}},F=function(e){return n=t(e),i=E(),r=document.querySelectorAll(n.selector),(s=r.length)?void[].forEach.call(r,function(e){W(e)}):void console.log("Ups, I can't find the selector "+n.selector+".")},G=function(e){W(e),s++};return F(e),{prev:X,next:C,open:x,close:N,add:G}};return e});