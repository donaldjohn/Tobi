(function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof module&&module.exports?module.exports=t():e.Tobi=t()})(this,function(){"use strict";var e=function(e){var t=function(e){var t={selector:".lightbox",captions:!0,captionsSelector:"img",captionAttribute:"alt",nav:"auto",navText:["&lsaquo;","&rsaquo;"],close:!0,closeText:"&times;",counter:!0,keyboard:!0,zoom:!0,zoomText:"&plus;",docClose:!1,swipeClose:!0,scroll:!1,draggable:!0,threshold:20};return e&&Object.keys(e).forEach(function(n){t[n]=e[n]}),t},n={},i=null,o=[],a=0,s=[],r=0,d={},l=!1,c=null,u=document.createElement("div");u.setAttribute("role","dialog"),u.setAttribute("aria-hidden","true"),u.classList.add("tobi-overlay"),document.getElementsByTagName("body")[0].appendChild(u);var m=document.createElement("div");m.classList.add("tobi-slider"),u.appendChild(m);var b=document.createElement("button");b.setAttribute("type","button"),b.setAttribute("aria-label","Previous"),u.appendChild(b);var p=document.createElement("button");p.setAttribute("type","button"),p.setAttribute("aria-label","Next"),u.appendChild(p);var f=document.createElement("button");f.setAttribute("type","button"),f.setAttribute("aria-label","Close"),u.appendChild(f);var g=document.createElement("div");g.classList.add("tobi-counter"),u.appendChild(g);var v=function(){var e=document.documentElement.style;return"string"==typeof e.transform?"transform":"WebkitTransform"},h=function(e,t){if("undefined"!=typeof o[e]&&"undefined"!=typeof s[e]){if(!s[e].getElementsByTagName("img")[0].hasAttribute("data-src"))return void(t&&t());var n=s[e].getElementsByTagName("figure")[0],i=n.getElementsByTagName("img")[0],a=n.getElementsByTagName("figcaption")[0];i.onload=function(){var e=n.querySelector(".tobi-loader");n.removeChild(e),i.style.opacity="1",a&&(a.style.opacity="1")},i.setAttribute("src",i.getAttribute("data-src")),i.removeAttribute("data-src"),t&&t()}},y=function(){var e=100*-r+"%";m.style[i]="translate3d("+e+", 0, 0)"},E=function(){g.innerHTML=r+1+"/"+o.length},L=function(e){n.nav?(b.disabled=!1,p.disabled=!1,r===o.length-1?p.disabled=!0:0===r&&(b.disabled=!0),"none"!==e||p.disabled?"none"===e&&p.disabled&&!b.disabled?b.focus():p.disabled||"right"!==e?p.disabled&&"right"===e&&!b.disabled?b.focus():b.disabled||"left"!==e?b.disabled&&"left"===e&&!p.disabled&&p.focus():b.focus():p.focus():p.focus()):n.close&&f.focus()},A=function(e){h(e)},T=function(){r<o.length-1&&(r++,y(),E(),L("right"),A(r+1))},k=function(){r>0&&(r--,y(),E(),L("left"),A(r-1))},C=function(e){var t=null,i=null,r=null,d=[],l=null,c=[],v=document.createElement("div");v.classList.add("tobi-slide"),v.id="tobi-slide-"+o.length,t=document.createElement("div"),t.classList.add("tobi-figure-wrapper"),t.id="tobi-figure-wrapper-"+o.length,i=document.createElement("figure"),i.innerHTML='<div class="tobi-loader"></div>',r=document.createElement("img"),r.style.opacity="0",e.getElementsByTagName("img")[0]&&e.getElementsByTagName("img")[0].alt?r.alt=e.getElementsByTagName("img")[0].alt:r.alt="",r.setAttribute("src",""),r.setAttribute("data-src",e.href),i.appendChild(r),n.captions&&(l=document.createElement("figcaption"),l.style.opacity="0","self"===n.captionsSelector&&e.getAttribute(n.captionAttribute)?l.innerHTML=e.getAttribute(n.captionAttribute):"img"===n.captionsSelector&&e.getElementsByTagName("img")[0].getAttribute(n.captionAttribute)&&(l.innerHTML=e.getElementsByTagName("img")[0].getAttribute(n.captionAttribute)),l.innerHTML&&(i.id="tobi-figure-"+a,l.id="tobi-figcaption-"+a,i.appendChild(l),d.push("tobi-figure-"+a),c.push("tobi-figcaption-"+a),++a)),t.appendChild(i),v.appendChild(t),m.appendChild(v),s.push(v),0!==a&&(u.setAttribute("aria-labelledby",d.join(" ")),u.setAttribute("aria-describedby",c.join(" "))),!n.nav||1===o.length||"auto"===n.nav&&"ontouchstart"in window?(b.style.display="none",p.style.display="none"):(b.style.display="initial",p.style.display="initial",b.innerHTML=n.navText[0],p.innerHTML=n.navText[1]),n.counter&&1!==o.length||(g.style.display="none"),n.close?f.innerHTML=n.closeText:f.style.display="none",n.draggable&&(m.style.cursor="-webkit-grab")},w=function(e){"false"!==u.getAttribute("aria-hidden")&&(n.scroll||(document.documentElement.classList.add("tobi--is-open"),document.body.classList.add("tobi--is-open")),c=document.activeElement,r=e,x(),O(),h(r,function(){A(r+1),A(r-1)}),y(),E(),u.setAttribute("aria-hidden","false"),L("none"))},X=function(){"true"!==u.getAttribute("aria-hidden")&&(n.scroll||(document.documentElement.classList.remove("tobi--is-open"),document.body.classList.remove("tobi--is-open")),_(),u.setAttribute("aria-hidden","true"),c.focus())},x=function(){d={startX:0,endX:0,startY:0,endY:0}},N=function(){var e=d.endX-d.startX,t=d.endY-d.startY,i=Math.abs(e),o=Math.abs(t);e>0&&i>n.threshold?k():e<0&&i>n.threshold?T():t<0&&o>n.threshold&&n.swipeClose&&X()},B=function(e){this===b?k():this===p?T():(this===f||this===u&&e.target.id.indexOf("tobi-figure-wrapper")!==-1)&&X(),e.preventDefault()},M=function(e){switch(e.keyCode){case 37:k();break;case 39:T();break;case 27:X()}},H=function(e){e.stopPropagation(),l=!0,d.startX=e.touches[0].pageX,d.startY=e.touches[0].pageY},Y=function(e){e.preventDefault(),e.stopPropagation(),l&&(d.endX=e.touches[0].pageX,d.endY=e.touches[0].pageY)},P=function(e){e.stopPropagation(),l=!1,d.endX&&N(),x()},z=function(e){e.preventDefault(),e.stopPropagation(),l=!0,d.startX=e.pageX},D=function(e){e.stopPropagation(),l=!1,m.style.cursor="-webkit-grab",d.endX&&N(),x()},S=function(e){e.preventDefault(),l&&(d.endX=e.pageX,m.style.cursor="-webkit-grabbing")},j=function(e){l&&(l=!1,m.style.cursor="-webkit-grab",d.endX=e.pageX,N(),x())},q=function(e){"false"!==u.getAttribute("aria-hidden")||u.contains(e.target)||(e.stopPropagation(),L("none"))},O=function(){n.keyboard&&document.addEventListener("keydown",M),n.docClose&&u.addEventListener("click",B),b.addEventListener("click",B),p.addEventListener("click",B),f.addEventListener("click",B),n.draggable&&(u.addEventListener("touchstart",H),u.addEventListener("touchmove",Y),u.addEventListener("touchend",P),u.addEventListener("mousedown",z),u.addEventListener("mouseup",D),u.addEventListener("mouseleave",j),u.addEventListener("mousemove",S)),document.addEventListener("focus",q,!0)},_=function(){n.keyboard&&document.removeEventListener("keydown",M),n.docClose&&u.removeEventListener("click",B),b.removeEventListener("click",B),p.removeEventListener("click",B),f.removeEventListener("click",B),n.draggable&&(u.removeEventListener("touchstart",H),u.removeEventListener("touchmove",Y),u.removeEventListener("touchend",P),u.removeEventListener("mousedown",z),u.removeEventListener("mouseup",D),u.removeEventListener("mouseleave",j),u.removeEventListener("mousemove",S)),document.removeEventListener("focus",q)},I=function(e){if(o.indexOf(e)===-1){if(o.push(e),e.classList.add("tobi"),n.zoom&&e.getElementsByTagName("img")[0]){var t=document.createElement("div");t.classList.add("tobi__zoom-icon"),t.innerHTML=n.zoomText,e.classList.add("tobi--zoom"),e.appendChild(t)}e.addEventListener("click",function(e){e.preventDefault(),w(o.indexOf(this))}),C(e)}},U=function(e){n=t(e),i=v();var o=document.querySelectorAll(n.selector);return o.length?void[].forEach.call(o,function(e){I(e)}):void console.log("Ups, I can't find the selector "+n.selector+".")};this.add=function(e){I(e)},U(e)};return e});